# Linux鸟哥私房菜基础学习篇

## 12 正则表达式与文本格式化处理

需要注意版本的字符格式是啥,不同的字符格式可能会不一样

拓展正则表达式`egrep` 可以直接通过|匹配不用的正则

### 12.1 grep

grep分析的是一行,当一行中有我们想要的东西,就把该行抽取出来

`grep [-A] [-B] [-acinv] [--color=auto]`

```shell
-a: 将binary文件以text文件的方式查找数据
-c: 计算找到`查找字符串`的次数
-i: 忽略大小写
-n: 输出行号
-v: 反向选择,即显示没有`查找字符串`的那一行
--color=auto: 可以将`查找字符串`加上颜色
-A: 后面直接跟数字,表示显示匹配行的后多少行
-B: 后面直接跟数字,表示显示匹配行的前多少行
```

`--color=auto`是一个很爽的东西,但是每次都要输入吗?.在Mac上改一下`~/.bash_profile`吧

1. ` vim ~/.bash_profile`: 添加`alias grep='grep --color=auto'`
2. 编译: `source ~/.bash_profile`,OK

正则注意点

1. `^`在`[]`外表示匹配行首,在`[]`内部表示反义
2. 用`{}`匹配时,因为`{与}`shell有语义所以必须`\{\}`转义

### 12.2 sed工具

`sed [-nefri] [动作]`

```shell
-n: 使用安静(silent)模式,在一般sed的用法中,所有STDIN的数据一般都会显示在屏幕上,加上`-n`后只有sed特殊处理的那一行(或者操作)才会被列出来
-e: 直接在命令行模式上进行sed的动作编辑
-f: 直接将sed的动作写在一个文件内,-f filename 则可以执行filename内的sed操作
-r: sed的动作支持的是扩张型正则表达式的语法(默认是基础正则表达式语法)
-i: 直接修改读取的文件内容,而不是屏幕输出

动作说明: [n1[,n2]]function
n1,n2: 一般代表选择进行动作的行数,举例来说,如果我的动作是需要在10~20行之间进行的,则"10,20[动作行为]"

function有下面这些参数

a: 新增,a后面可以接字符串,而这些字符串会在新的一行出现(目前的下一行)
c: 替换,c后面可以接字符串,这些字符串可以替换n1,n2之间的行
d: 删除
i: 插入,i后面可以接字符串,而这些字符串会在新的一行出现(当前行的上一行)
p: 打印,也就是将某个选择的数据打印出来,通常p会跟参数sedn -n一起运行
s: 替换,可以直接进行替换工作,通常这个s可以搭配正则表达式
```

注意点

1. sed增加两行

    ```shell
    nl /etc/passwd | sed '2a Drink tea...\
    > drik beer'
    ```
2. 替换: `sed 's/要被替换的字符串/新的字符串/g'`

### 16.3 awk

`awk '条件类型1{动作1} 条件类型2{动作2} ...' filename`

默认变量
1. $0: 代表整行
2. $1~$n: 代表第n个字段
3. NF: 表示每一行拥有的字段数
4. NR: 代表正在处理的第几行
5. FS: 目前的分割字符,默认是空格键

注意事项

1. 所有awk动作,即在{}内的动作,如果有需要多个命令辅助时,可以用`;`间隔,或者直接以`[Enter]`按键来隔开每个命令,
2. awk的变量无需`$`,直接使用即可
3. awk支付`if`


## 16.例行性工作

### 16.1 任务分类

1. 仅执行一次的命令: at设置只执行一次的命令(需要atd服务的支持)
2. 常规性命令: crontab循环性指令(需要crond服务)

### 16.2 仅执行一次的工作调度

linux检查有无atd服务: `/etc/init.d/atd status`

linux开机自启动atd: `chkconfig atd on`

这里发现at在ubuntu和书籍中很多不符,暂不研究

## 16.3 循环执行的例行性工作调度

### 16.3.1 用户的设置

限制用户

1. 设置允许的用户: /etc/cron.allow
2. 设置不允许的用户: /etc/cron.deny

优先性: cron.allow>cron.deny

命令说明

```shell
crontab [-u username] [-l|-e|-r]

-u: 只有root才能执行/帮其他用户新建/删除crontab
-e: 编辑crontab
-l: 列出所有crontab
-r: 删除所有crontab
```
命令设置

`分钟 小时 日期 月份 周 命令`

特别的符号代表

1. `*`: 此字段不做限制
2. `,`: 在符合的数字字段都可执行`||`
3. `-`: 时间范围设置
4. `/n`: 每隔n执行





